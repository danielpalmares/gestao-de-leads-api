# üöÄ Gest√£o de Leads API

API RESTful para gerenciamento de leads desenvolvida com Node.js, TypeScript, Express, Prisma e PostgreSQL. Inclui autentica√ß√£o JWT, filtros avan√ßados, pagina√ß√£o e valida√ß√£o robusta.

## üìë √çndice

- [Pr√©-requisitos](#-pr√©-requisitos)
- [Configura√ß√£o do Ambiente](#Ô∏è-configura√ß√£o-do-ambiente)
- [Scripts Dispon√≠veis](#Ô∏è-scripts-dispon√≠veis)
- [Documenta√ß√£o da API](#-documenta√ß√£o-da-api)
  - [Autentica√ß√£o](#-autentica√ß√£o)
  - [Endpoints](#-endpoints)
  - [C√≥digos de Erro](#-c√≥digos-de-erro-comuns)
  - [Exemplos com cURL](#-exemplos-com-curl)
- [Vari√°veis de Ambiente](#-vari√°veis-de-ambiente)
- [Docker](#-docker)
- [Prisma Studio](#-prisma-studio)
- [Arquitetura e Tecnologias](#Ô∏è-arquitetura-e-tecnologias)
- [Contribui√ß√£o](#-contribui√ß√£o)
- [Licen√ßa](#-licen√ßa)

## üìã Pr√©-requisitos

- Node.js (vers√£o 18 ou superior)
- Docker e Docker Compose
- npm ou yarn

## üõ†Ô∏è Configura√ß√£o do Ambiente

### 1. Instalar depend√™ncias

```bash
npm install
```

### 2. Configurar vari√°veis de ambiente

```bash
cp .env.example .env
```

Edite o arquivo `.env` conforme necess√°rio.

### 3. Configurar banco de dados

```bash
# Iniciar PostgreSQL com Docker
npm run db:up

# Gerar cliente Prisma
npm run db:generate

# Executar migra√ß√µes
npm run db:migrate

# Popular banco com dados de exemplo (opcional)
npm run db:seed
```

### 4. Iniciar aplica√ß√£o

```bash
npm run dev
```

A API estar√° dispon√≠vel em `http://localhost:3000`

## üóÉÔ∏è Scripts Dispon√≠veis

| Script                | Descri√ß√£o                                |
| --------------------- | ---------------------------------------- |
| `npm run dev`         | Inicia aplica√ß√£o em modo desenvolvimento |
| `npm run db:up`       | Inicia container PostgreSQL              |
| `npm run db:down`     | Para container PostgreSQL                |
| `npm run db:reset`    | Reinicia container PostgreSQL            |
| `npm run db:migrate`  | Executa migra√ß√µes do banco               |
| `npm run db:studio`   | Abre Prisma Studio                       |
| `npm run db:generate` | Gera cliente Prisma                      |
| `npm run db:seed`     | Popula banco com dados de exemplo        |

## üìä Prisma Studio

Para visualizar e gerenciar dados do banco:

```bash
npm run db:studio
```

## üê≥ Docker

### Configura√ß√£o do PostgreSQL

O banco PostgreSQL roda em container Docker e usa as credenciais definidas no arquivo `.env`:

- **Porta:** Definida por `POSTGRES_PORT` (padr√£o: 5432)
- **Database:** Definido por `POSTGRES_DB` (padr√£o: leads_db)
- **Usu√°rio:** Definido por `POSTGRES_USER` (padr√£o: leads_user)
- **Senha:** Definida por `POSTGRES_PASSWORD` (padr√£o: leads_password)

### Comandos Docker √∫teis

```bash
# Ver logs do PostgreSQL
docker-compose logs postgres

# Acessar container PostgreSQL (usando vari√°veis do .env)
docker-compose exec postgres psql -U $POSTGRES_USER -d $POSTGRES_DB
```

## üèóÔ∏è Arquitetura

```
src/
‚îú‚îÄ‚îÄ cases/
‚îÇ   ‚îî‚îÄ‚îÄ Lead/
‚îÇ       ‚îú‚îÄ‚îÄ create/
‚îÇ       ‚îú‚îÄ‚îÄ read/
‚îÇ       ‚îú‚îÄ‚îÄ update/
‚îÇ       ‚îî‚îÄ‚îÄ delete/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ repositories/
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îî‚îÄ‚îÄ entities/
‚îî‚îÄ‚îÄ utils/
```

## üìù Documenta√ß√£o da API

### üîê Autentica√ß√£o

A API utiliza **JWT (JSON Web Tokens)** para autentica√ß√£o. Para acessar rotas protegidas, voc√™ deve:

1. Fazer login em `/auth/login`
2. Usar o token retornado no header `Authorization: Bearer <token>`

#### Credenciais padr√£o:

- **Username:** `admin`
- **Password:** `admin123`

### üåê Endpoints

#### üîì Rotas P√∫blicas

##### POST /auth/login

Autenticar usu√°rio e obter token JWT.

**Request:**

```json
{
  "username": "admin",
  "password": "admin123"
}
```

**Response (200):**

```json
{
  "message": "Login realizado com sucesso",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expiresIn": "24h"
}
```

**Errors:**

- `400` - Username/password n√£o fornecidos
- `401` - Credenciais inv√°lidas

---

##### POST /leads

Criar um novo lead.

**Request:**

```json
{
  "name": "Jo√£o Silva",
  "email": "joao@email.com",
  "phone_number": "11999999999",
  "role": "Desenvolvedor",
  "birth_date": "1990-05-15",
  "message": "Interessado em oportunidades"
}
```

**Response (201):**

```json
{
  "result": {
    "id": "uuid-123",
    "name": "Jo√£o Silva",
    "email": "joao@email.com",
    "phone_number": "11999999999",
    "role": "Desenvolvedor",
    "birth_date": "1990-05-15T00:00:00.000Z",
    "message": "Interessado em oportunidades"
  },
  "status": 201
}
```

**Valida√ß√µes:**

- `name`: m√≠nimo 3 caracteres
- `email`: formato v√°lido e √∫nico
- `phone_number`: 10-11 d√≠gitos
- `role`: m√≠nimo 2 caracteres
- `birth_date`: data v√°lida (1900 at√© hoje)
- `message`: 10-500 caracteres

---

#### üîí Rotas Protegidas

> **Nota:** Todas as rotas abaixo requerem header `Authorization: Bearer <token>`

##### GET /leads

Listar leads com filtros e pagina√ß√£o.

**Query Parameters:**

- `name` (opcional): Filtro por nome (busca parcial)
- `email` (opcional): Filtro por email (busca parcial)
- `page` (opcional): N√∫mero da p√°gina (padr√£o: 1)
- `limit` (opcional): Itens por p√°gina (padr√£o: 10, m√°ximo: 100)

**Examples:**

```bash
# Listar todos (primeira p√°gina, 10 itens)
GET /leads

# Filtrar por nome
GET /leads?name=Jo√£o

# Filtrar por email
GET /leads?email=gmail

# Pagina√ß√£o
GET /leads?page=2&limit=5

# Combinar filtros
GET /leads?name=Maria&email=hotmail&page=1&limit=20
```

**Response (200):**

```json
{
  "result": {
    "leads": [
      {
        "id": "uuid-123",
        "name": "Jo√£o Silva",
        "email": "joao@email.com",
        "phone_number": "11999999999",
        "role": "Desenvolvedor",
        "birth_date": "1990-05-15T00:00:00.000Z",
        "message": "Interessado em oportunidades"
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 10,
    "total_pages": 5
  },
  "status": 200
}
```

---

##### GET /leads/:id

Buscar lead por ID.

**Response (200):**

```json
{
  "result": {
    "id": "uuid-123",
    "name": "Jo√£o Silva",
    "email": "joao@email.com",
    "phone_number": "11999999999",
    "role": "Desenvolvedor",
    "birth_date": "1990-05-15T00:00:00.000Z",
    "message": "Interessado em oportunidades"
  },
  "status": 200
}
```

**Errors:**

- `404` - Lead n√£o encontrado

---

##### PUT /leads/:id

Atualizar lead existente.

**Request (todos os campos opcionais):**

```json
{
  "name": "Jo√£o Santos",
  "email": "joao.santos@email.com",
  "role": "Senior Developer"
}
```

**Response (200):**

```json
{
  "result": {
    "id": "uuid-123",
    "name": "Jo√£o Santos",
    "email": "joao.santos@email.com",
    "phone_number": "11999999999",
    "role": "Senior Developer",
    "birth_date": "1990-05-15T00:00:00.000Z",
    "message": "Interessado em oportunidades"
  },
  "status": 200
}
```

**Valida√ß√µes:**

- Pelo menos um campo deve ser fornecido
- Mesmas valida√ß√µes do POST (quando fornecidos)

**Errors:**

- `404` - Lead n√£o encontrado

---

##### DELETE /leads/:id

Deletar lead.

**Response (200):**

```json
{
  "result": {
    "message": "Lead deletado com sucesso"
  },
  "status": 200
}
```

**Errors:**

- `404` - Lead n√£o encontrado

---

### üö® C√≥digos de Erro Comuns

| C√≥digo | Descri√ß√£o             | Exemplo                               |
| ------ | --------------------- | ------------------------------------- |
| `400`  | Bad Request           | Dados inv√°lidos ou faltando           |
| `401`  | Unauthorized          | Token inv√°lido/expirado/n√£o fornecido |
| `404`  | Not Found             | Lead n√£o encontrado                   |
| `422`  | Validation Error      | Dados n√£o passaram na valida√ß√£o       |
| `500`  | Internal Server Error | Erro interno do servidor              |

### üìä Exemplos com cURL

#### 1. Fazer Login

```bash
curl -X POST http://localhost:3000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

#### 2. Criar Lead

```bash
curl -X POST http://localhost:3000/leads \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Jo√£o Silva",
    "email": "joao@test.com",
    "phone_number": "11999999999",
    "role": "Developer",
    "birth_date": "1990-01-01",
    "message": "Interessado em oportunidades"
  }'
```

#### 3. Listar Leads (com token)

```bash
curl -X GET http://localhost:3000/leads \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

#### 4. Buscar Lead por ID

```bash
curl -X GET http://localhost:3000/leads/uuid-123 \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

#### 5. Atualizar Lead

```bash
curl -X PUT http://localhost:3000/leads/uuid-123 \
  -H "Authorization: Bearer SEU_TOKEN_AQUI" \
  -H "Content-Type: application/json" \
  -d '{"name": "Jo√£o Santos"}'
```

#### 6. Deletar Lead

```bash
curl -X DELETE http://localhost:3000/leads/uuid-123 \
  -H "Authorization: Bearer SEU_TOKEN_AQUI"
```

## üîß Vari√°veis de Ambiente

### Configura√ß√£o inicial

1. Copie o arquivo de exemplo:

```bash
cp .env.example .env
```

2. Edite o arquivo `.env` com suas configura√ß√µes:

```env
# Database credentials
POSTGRES_USER=leads_user
POSTGRES_PASSWORD=leads_password
POSTGRES_DB=leads_db
POSTGRES_HOST=localhost
POSTGRES_PORT=5432

# PostgreSQL database connection string
DATABASE_URL="postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?schema=public"

# JWT Authentication
JWT_SECRET=sua-chave-secreta-super-segura
AUTH_USERNAME=admin
AUTH_PASSWORD=admin123
```

### Vari√°veis dispon√≠veis

| Vari√°vel            | Descri√ß√£o               | Valor padr√£o           |
| ------------------- | ----------------------- | ---------------------- |
| `POSTGRES_USER`     | Usu√°rio do PostgreSQL   | `leads_user`           |
| `POSTGRES_PASSWORD` | Senha do PostgreSQL     | `leads_password`       |
| `POSTGRES_DB`       | Nome do banco de dados  | `leads_db`             |
| `POSTGRES_HOST`     | Host do PostgreSQL      | `localhost`            |
| `POSTGRES_PORT`     | Porta do PostgreSQL     | `5432`                 |
| `DATABASE_URL`      | URL completa de conex√£o | Gerada automaticamente |
| `JWT_SECRET`        | Chave secreta do JWT    | Definir valor seguro   |
| `AUTH_USERNAME`     | Usu√°rio da API          | `admin`                |
| `AUTH_PASSWORD`     | Senha da API            | `admin123`             |

### ‚ö†Ô∏è Seguran√ßa

Em produ√ß√£o, certifique-se de:

- Usar uma `JWT_SECRET` forte e √∫nica
- Alterar `AUTH_USERNAME` e `AUTH_PASSWORD` padr√£o
- Usar HTTPS sempre
- N√£o commitar o arquivo `.env`

## üèóÔ∏è Arquitetura e Tecnologias

### Stack Tecnol√≥gico

- **Node.js** - Runtime JavaScript
- **TypeScript** - Tipagem est√°tica
- **Express.js** - Framework web
- **Prisma** - ORM e query builder
- **PostgreSQL** - Banco de dados relacional
- **JWT** - Autentica√ß√£o stateless
- **Zod** - Valida√ß√£o de schemas
- **Docker** - Containeriza√ß√£o

### Arquitetura

```
src/
‚îú‚îÄ‚îÄ cases/                    # Use cases (business logic)
‚îÇ   ‚îî‚îÄ‚îÄ Lead/
‚îÇ       ‚îú‚îÄ‚îÄ create/          # Criar lead
‚îÇ       ‚îú‚îÄ‚îÄ read/            # Listar/buscar leads
‚îÇ       ‚îú‚îÄ‚îÄ update/          # Atualizar lead
‚îÇ       ‚îî‚îÄ‚îÄ delete/          # Deletar lead
‚îú‚îÄ‚îÄ controllers/             # Controllers HTTP
‚îÇ   ‚îî‚îÄ‚îÄ auth_controller.ts
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ database/           # Configura√ß√£o do banco
‚îÇ   ‚îî‚îÄ‚îÄ repositories/       # Reposit√≥rios de dados
‚îÇ       ‚îú‚îÄ‚îÄ interfaces/     # Contratos/interfaces
‚îÇ       ‚îî‚îÄ‚îÄ implementations/ # Implementa√ß√µes concretas
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îî‚îÄ‚îÄ entities/           # Entidades de dom√≠nio
‚îú‚îÄ‚îÄ middlewares/            # Middlewares Express
‚îú‚îÄ‚îÄ routes/                 # Defini√ß√£o de rotas
‚îú‚îÄ‚îÄ setup/                  # Inje√ß√£o de depend√™ncias
‚îî‚îÄ‚îÄ utils/                  # Utilit√°rios
    ‚îú‚îÄ‚îÄ errors/             # Tratamento de erros
    ‚îú‚îÄ‚îÄ process/            # Processamento
    ‚îî‚îÄ‚îÄ zod/                # Valida√ß√µes
```

### Padr√µes Implementados

- **Clean Architecture** - Separa√ß√£o clara de responsabilidades
- **Repository Pattern** - Abstra√ß√£o da camada de dados
- **Use Cases** - L√≥gica de neg√≥cio isolada
- **Dependency Injection** - Invers√£o de depend√™ncias
- **Error Handling** - Tratamento robusto de erros
- **Input Validation** - Valida√ß√£o com Zod
- **JWT Authentication** - Autentica√ß√£o moderna

### Features

- ‚úÖ **CRUD Completo** - Create, Read, Update, Delete
- ‚úÖ **Autentica√ß√£o JWT** - Login seguro com tokens
- ‚úÖ **Filtros Avan√ßados** - Busca por nome e email
- ‚úÖ **Pagina√ß√£o** - Listagem eficiente com pagination
- ‚úÖ **Valida√ß√£o Robusta** - Schemas Zod para todos inputs
- ‚úÖ **Tratamento de Erros** - Respostas consistentes
- ‚úÖ **Tipagem Forte** - TypeScript em 100% do c√≥digo
- ‚úÖ **Banco Relacional** - PostgreSQL com Prisma
- ‚úÖ **Containeriza√ß√£o** - Docker para desenvolvimento
- ‚úÖ **Documenta√ß√£o** - README completo

## ü§ù Contribui√ß√£o

1. Fork o projeto
2. Crie uma branch (`git checkout -b feature/nova-feature`)
3. Commit suas mudan√ßas (`git commit -m 'Add nova feature'`)
4. Push para a branch (`git push origin feature/nova-feature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para detalhes.
